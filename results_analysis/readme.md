Code adapted from https://github.com/tml-epfl/understanding-sam/tree/main/deep_nets